names(harry)
sigSumFlex <- flextable(head(harry), col_keys = names(head(harry)))
colnames(harry) <- paste("name", 1:length(names(harry)), sep = "-")
sigSumFlex <- flextable(head(harry), col_keys = names(head(harry)))
colnames(harry) <- paste("name", 1:length(names(harry)), sep = "_")
names(harry)
sigSumFlex <- flextable(head(harry), col_keys = names(head(harry)))
colnames(harry) <- paste("name", 1:length(names(harry)), sep = " ")
sigSumFlex <- flextable(head(harry), col_keys = names(head(harry)))
rm(list=ls())
options(stringsAsFactors = FALSE)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#gene level results
geneLevel = dge.genes
geneLevel$geneLevel_pctDiff = paste(sprintf("%.1f",round(100*(2^geneLevel$log2FoldChange),1)),"%",sep="") #format percent differential expression
geneLevel$geneLevel_pvalue = format(geneLevel$pvalue,digits=2,scientific=TRUE) #format p-value
geneLevel$geneLevel_FDR = sprintf("%.4f",round(geneLevel$padj,4)) #format false discovery rate (10%)
geneLevel$geneLevel_FDR[geneLevel$geneLevel_FDR=="0.0000"] = "<0.0001" #format low p-values into somethig that makes sense
geneLevel = geneLevel[,c("Gene.stable.ID","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
#isolate significant isoforms - FDR<0.05
sigGenes <- dge_v2[dge_v2$padj<0.05,]
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #format gene description
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #format location by converting to mega bases
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #add chr label to location
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #format strand direction
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="")
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE)
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4))
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001"
sigGenes$treated_isoPct = paste(sprintf("%.1f",round(sigGenes$treated_isoPct,1)),"%")
sigGenes$Untreated_isoPct = paste(sprintf("%.1f",round(sigGenes$Untreated_isoPct,1)),"%")
sigGenes = merge(sigGenes,geneLevel,by="Gene.stable.ID",all.x=T)
sigGenes = sigGenes[,c("Gene.name","Gene.description","Gene.stable.ID","Transcript.stable.ID","Transcript.count","GeneLoc","Strand","Gene.type","pctOfControl","pvalue","FDR","treated_isoPct","Untreated_isoPct","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
sigGenes = sigGenes[order(sigGenes$pvalue),]
colnames(sigGenes) = c("Gene Symbol","Gene Description","Ensembl Gene ID","Ensembl Transcript ID","Number of Isoforms","Gene Location","Strand","Transcript Type","Expression in Cases as Percent of Controls","Unadjusted P-value","FDR","Median Percent of Reads from Gene Allotted to this Isoform - Cases","Median Percent of Reads from Gene Allotted to this Isoform - Controls","Percent Difference in Gene Level Analysis","Unadjusted pvalue in Gene Level Analysis","FDR in Gene Level Analysis")
sigSummary <- sigGenes
save(sigSummary, geneLevel, file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/SigSummary.RData")
write.csv(sigSummary,file="/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/tables/sigSummary.csv",row.names=FALSE,quote=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#isolate significant results - FDR<0.05
sigGenes <- dge.genes[dge.genes$padj<0.05,] #Pull out genes with adjusted p-values less than 0.05
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #remove the source annotation
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #Convert Gene start into Mb units and round to 1 decimal place
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #Make location variable look like chr1:##Mb
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #Assign positive or negative symbol to the appropriate strand
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="") ##Back transform fold change from log base 2, and format into a percent
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE) #Format p-value
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4)) #format false discovery rate
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001" #Format low false discovery rate to something more readable
sigGenes = sigGenes[,c("Gene.name","Description","Gene.stable.ID","Transcript.count","GeneLoc","strand","Gene.type","pctOfControl","pvalue","FDR")]
colnames(sigGenes) = c("Gene Symbol","Gene Description","Ensembl Gene ID","Number of Isoforms","Gene Location","Strand","Gene Type","Expression in Cases as Percent of Controls","Unadjusted P-value","FDR")
save(sigGenes, file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/SigGenes.RData")
write.csv(sigGenes, file="/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/tables/sigGenes.csv",row.names=FALSE,quote=FALSE)
sigGenes <- sigGenes[order(sigGenes$`Unadjusted P-value`), ]
save(sigGenes, file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/SigGenes.RData")
write.csv(sigGenes, file="/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/tables/sigGenes.csv",row.names=FALSE,quote=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#gene level results
geneLevel = dge.genes
geneLevel$geneLevel_pctDiff = paste(sprintf("%.1f",round(100*(2^geneLevel$log2FoldChange),1)),"%",sep="") #format percent differential expression
geneLevel$geneLevel_pvalue = format(geneLevel$pvalue,digits=2,scientific=TRUE) #format p-value
geneLevel$geneLevel_FDR = sprintf("%.4f",round(geneLevel$padj,4)) #format false discovery rate (10%)
geneLevel$geneLevel_FDR[geneLevel$geneLevel_FDR=="0.0000"] = "<0.0001" #format low p-values into somethig that makes sense
geneLevel = geneLevel[,c("Gene.stable.ID","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
#isolate significant isoforms - FDR<0.05
sigGenes <- dge_v2[dge_v2$padj<0.05,]
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #format gene description
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #format location by converting to mega bases
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #add chr label to location
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #format strand direction
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="")
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE)
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4))
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001"
sigGenes$treated_isoPct = paste(sprintf("%.1f",round(sigGenes$treated_isoPct,1)),"%")
sigGenes$Untreated_isoPct = paste(sprintf("%.1f",round(sigGenes$Untreated_isoPct,1)),"%")
sigGenes = merge(sigGenes,geneLevel,by="Gene.stable.ID",all.x=T)
sigGenes = sigGenes[,c("Gene.name","Gene.description","Gene.stable.ID","Transcript.stable.ID","Transcript.count","GeneLoc","Strand","Gene.type","pctOfControl","pvalue","FDR","treated_isoPct","Untreated_isoPct","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
sigGenes = sigGenes[order(sigGenes$pvalue),]
colnames(sigGenes) = c("Gene Symbol","Gene Description","Ensembl Gene ID","Ensembl Transcript ID","Number of Isoforms","Gene Location","Strand","Transcript Type","Expression in Cases as Percent of Controls","Unadjusted P-value","FDR","Median Percent of Reads from Gene Allotted to this Isoform - Cases","Median Percent of Reads from Gene Allotted to this Isoform - Controls","Percent Difference in Gene Level Analysis","Unadjusted pvalue in Gene Level Analysis","FDR in Gene Level Analysis")
sigSummary <- sigGenes
View(sigSummary)
rm(list=ls())
options(stringsAsFactors = FALSE)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#gene level results
geneLevel = dge.genes
geneLevel$geneLevel_pctDiff = paste(sprintf("%.1f",round(100*(2^geneLevel$log2FoldChange),1)),"%",sep="") #format percent differential expression
geneLevel$geneLevel_pvalue = format(geneLevel$pvalue,digits=2,scientific=TRUE) #format p-value
geneLevel$geneLevel_FDR = sprintf("%.4f",round(geneLevel$padj,4)) #format false discovery rate (10%)
geneLevel$geneLevel_FDR[geneLevel$geneLevel_FDR=="0.0000"] = "<0.0001" #format low p-values into somethig that makes sense
geneLevel = geneLevel[,c("Gene.stable.ID","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
#isolate significant isoforms - FDR<0.05
sigGenes <- dge_v2[dge_v2$padj<0.05,]
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #format gene description
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #format location by converting to mega bases
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #add chr label to location
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #format strand direction
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="")
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE)
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4))
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001"
sigGenes$treated_isoPct = paste(sprintf("%.1f",round(sigGenes$treated_isoPct,1)),"%")
sigGenes$Untreated_isoPct = paste(sprintf("%.1f",round(sigGenes$Untreated_isoPct,1)),"%")
sigGenes = merge(sigGenes,geneLevel,by="Gene.stable.ID",all.x=T)
sigGenes = sigGenes[,c("Gene.name","Gene.description","Gene.stable.ID","Transcript.stable.ID","Transcript.count","GeneLoc","Strand","Gene.type","pctOfControl","pvalue","FDR","treated_isoPct","Untreated_isoPct","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
sigGenes = sigGenes[order(sigGenes$pvalue),]
View(sigGenes)
rm(list=ls())
options(stringsAsFactors = FALSE)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#gene level results
geneLevel = dge.genes
geneLevel$geneLevel_pctDiff = paste(sprintf("%.1f",round(100*(2^geneLevel$log2FoldChange),1)),"%",sep="") #format percent differential expression
geneLevel$geneLevel_pvalue = format(geneLevel$pvalue,digits=2,scientific=TRUE) #format p-value
geneLevel$geneLevel_FDR = sprintf("%.4f",round(geneLevel$padj,4)) #format false discovery rate (10%)
geneLevel$geneLevel_FDR[geneLevel$geneLevel_FDR=="0.0000"] = "<0.0001" #format low p-values into somethig that makes sense
geneLevel = geneLevel[,c("Gene.stable.ID","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
#isolate significant isoforms - FDR<0.05
sigGenes <- dge_v2[dge_v2$padj<0.05,]
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #format gene description
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #format location by converting to mega bases
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #add chr label to location
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #format strand direction
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="")
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE)
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4))
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001"
sigGenes$treated_isoPct = paste(sprintf("%.1f",round(sigGenes$treated_isoPct,1)),"%")
sigGenes$Untreated_isoPct = paste(sprintf("%.1f",round(sigGenes$Untreated_isoPct,1)),"%")
sigGenes = merge(sigGenes,geneLevel,by="Gene.stable.ID",all.x=T)
sigGenes = sigGenes[,c("Gene.name","Gene.description","Gene.stable.ID","Transcript.stable.ID","Transcript.count","GeneLoc","Strand","Gene.type","pctOfControl","pvalue","FDR","treated_isoPct","Untreated_isoPct","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
sigGenes = sigGenes[order(sigGenes$pvalue),]
colnames(sigGenes) = c("Gene Symbol","Gene Description","Ensembl Gene ID","Ensembl Transcript ID","Number of Isoforms","Gene Location","Strand","Transcript Type","Expression in Cases as Percent of Controls","Unadjusted P-value","FDR","Median Percent of Reads from Gene Allotted to this Isoform - Cases","Median Percent of Reads from Gene Allotted to this Isoform - Controls","Percent Difference in Gene Level Analysis","Unadjusted pvalue in Gene Level Analysis","FDR in Gene Level Analysis")
sigSummary <- sigGenes
save(sigSummary, geneLevel, file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/SigSummary.RData")
write.csv(sigSummary,file="/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/tables/sigSummary.csv",row.names=FALSE,quote=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#isolate significant results - FDR<0.05
sigGenes <- dge.genes[dge.genes$padj<0.05,] #Pull out genes with adjusted p-values less than 0.05
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #remove the source annotation
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #Convert Gene start into Mb units and round to 1 decimal place
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #Make location variable look like chr1:##Mb
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #Assign positive or negative symbol to the appropriate strand
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="") ##Back transform fold change from log base 2, and format into a percent
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE) #Format p-value
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4)) #format false discovery rate
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001" #Format low false discovery rate to something more readable
sigGenes = sigGenes[,c("Gene.name","Description","Gene.stable.ID","Transcript.count","GeneLoc","strand","Gene.type","pctOfControl","pvalue","FDR")]
colnames(sigGenes) = c("Gene Symbol","Gene Description","Ensembl Gene ID","Number of Isoforms","Gene Location","Strand","Gene Type","Expression in Cases as Percent of Controls","Unadjusted P-value","FDR")
save(sigGenes, file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/SigGenes.RData")
write.csv(sigGenes, file="/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/tables/sigGenes.csv",row.names=FALSE,quote=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#gene level results
geneLevel = dge.genes
geneLevel$geneLevel_pctDiff = paste(sprintf("%.1f",round(100*(2^geneLevel$log2FoldChange),1)),"%",sep="") #format percent differential expression
geneLevel$geneLevel_pvalue = format(geneLevel$pvalue,digits=2,scientific=TRUE) #format p-value
geneLevel$geneLevel_FDR = sprintf("%.4f",round(geneLevel$padj,4)) #format false discovery rate (10%)
geneLevel$geneLevel_FDR[geneLevel$geneLevel_FDR=="0.0000"] = "<0.0001" #format low p-values into somethig that makes sense
geneLevel = geneLevel[,c("Gene.stable.ID","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
#isolate significant isoforms - FDR<0.05
sigGenes <- dge_v2[dge_v2$padj<0.05,]
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #format gene description
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #format location by converting to mega bases
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #add chr label to location
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #format strand direction
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="")
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE)
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4))
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001"
sigGenes$treated_isoPct = paste(sprintf("%.1f",round(sigGenes$treated_isoPct,1)),"%")
sigGenes$Untreated_isoPct = paste(sprintf("%.1f",round(sigGenes$Untreated_isoPct,1)),"%")
sigGenes = merge(sigGenes,geneLevel,by="Gene.stable.ID",all.x=T)
sigGenes = sigGenes[,c("Gene.name","Gene.description","Gene.stable.ID","Transcript.stable.ID","Transcript.count","GeneLoc","Strand","Gene.type","pctOfControl","pvalue","FDR","treated_isoPct","Untreated_isoPct","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
sigGenes = sigGenes[order(sigGenes$pvalue),]
sigGenes$Gene.description <- gsub(",", ";", sigGenes$Gene.description, fixed = T)
colnames(sigGenes) = c("Gene Symbol","Gene Description","Ensembl Gene ID","Ensembl Transcript ID","Number of Isoforms","Gene Location","Strand","Transcript Type","Expression in Cases as Percent of Controls","Unadjusted P-value","FDR","Median Percent of Reads from Gene Allotted to this Isoform - Cases","Median Percent of Reads from Gene Allotted to this Isoform - Controls","Percent Difference in Gene Level Analysis","Unadjusted pvalue in Gene Level Analysis","FDR in Gene Level Analysis")
sigSummary <- sigGenes
save(sigSummary, geneLevel, file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/SigSummary.RData")
write.csv(sigSummary,file="/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/tables/sigSummary.csv",row.names=FALSE,quote=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#isolate significant results - FDR<0.05
sigGenes <- dge.genes[dge.genes$padj<0.05,] #Pull out genes with adjusted p-values less than 0.05
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #remove the source annotation
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #Convert Gene start into Mb units and round to 1 decimal place
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #Make location variable look like chr1:##Mb
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #Assign positive or negative symbol to the appropriate strand
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="") ##Back transform fold change from log base 2, and format into a percent
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE) #Format p-value
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4)) #format false discovery rate
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001" #Format low false discovery rate to something more readable
sigGenes = sigGenes[,c("Gene.name","Description","Gene.stable.ID","Transcript.count","GeneLoc","strand","Gene.type","pctOfControl","pvalue","FDR")]
sigGenes$Gene.description <- gsub(",", ";", sigGenes$Gene.description, fixed = T)
colnames(sigGenes) = c("Gene Symbol","Gene Description","Ensembl Gene ID","Number of Isoforms","Gene Location","Strand","Gene Type","Expression in Cases as Percent of Controls","Unadjusted P-value","FDR")
save(sigGenes, file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/SigGenes.RData")
write.csv(sigGenes, file="/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/tables/sigGenes.csv",row.names=FALSE,quote=FALSE)
## WORKING FROM LOCAL MACHINE SOURCE ##
source("~/Desktop/Saba_Lab/Liver/code/rsem.read.R")
## Create global directory objects
dir <- "/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/"
dirs2 <- "/Volumes/rn6/quantitation/liverTotalRNA/RI/"
dirlocal <- "~/Desktop/Saba_Lab/"
N <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
tissue <- "Liver"
options(stringsAsFactors = FALSE)
library(rtracklayer)
library(GenomicRanges)
ST_gtfClean <- import(paste(directory, file_merged, sep = ""))
directory <- paste(dirlocal, tissue, "/quantitation/", sep = "")
file_merged <- "stringtie_results_liver.gtf"
sample_merged <- "merged"
options(stringsAsFactors = FALSE)
library(rtracklayer)
library(GenomicRanges)
ST_gtfClean <- import(paste(directory, file_merged, sep = ""))
ST_df <- as.data.frame(ST_gtfClean) #Converts the object above to a dataframe
View(ST_df)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#gene level results
geneLevel = dge.genes
View(geneLevel)
geneLevel$geneLevel_pctDiff = paste(sprintf("%.1f",round(100*(2^geneLevel$log2FoldChange),1)),"%",sep="") #format percent differential expression
geneLevel$geneLevel_pvalue = format(geneLevel$pvalue,digits=2,scientific=TRUE) #format p-value
geneLevel$geneLevel_FDR = sprintf("%.4f",round(geneLevel$padj,4)) #format false discovery rate (10%)
geneLevel$geneLevel_FDR[geneLevel$geneLevel_FDR=="0.0000"] = "<0.0001" #format low p-values into somethig that makes sense
geneLevel = geneLevel[,c("Gene.stable.ID","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
#isolate significant isoforms - FDR<0.05
sigGenes <- dge_v2[dge_v2$padj<0.05,]
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #format gene description
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #format location by converting to mega bases
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #add chr label to location
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #format strand direction
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="")
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE)
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4))
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001"
sigGenes$treated_isoPct = paste(sprintf("%.1f",round(sigGenes$treated_isoPct,1)),"%")
sigGenes$Untreated_isoPct = paste(sprintf("%.1f",round(sigGenes$Untreated_isoPct,1)),"%")
sigGenes = merge(sigGenes,geneLevel,by="Gene.stable.ID",all.x=T)
View(sigGenes)
harry <- ST_df
colnames(harry)[5] <- "Strand"
harry <- harry[, c(5,10, 11)]
smith <- merge(sigGenes, harry, by.x = "Transcript.stable.ID", by.y = "transcript_id")
View(smith)
rm(smith)
smith <- merge(sigGenes, harry, by.x = "Transcript.stable.ID", by.y = "transcript_id", all.x = TRUE)
View(smith)
View(sigGenes)
harry <- ST_df
for(i in 1:length(sigGenes$Transcript.stable.ID)) {
txpos <- match(sigGenes$Transcript.stable.ID[i], harry$transcript_id)
tID <- BXH1IR.nospike$transcript_id[txpos]
if(startsWith(tID, "MSTRG")){sigGenes$Strand[i] = harry$strand[txpos]} else {sigGenes$Strand[i] = sigGenes$Strand[i]}
}
for(i in 1:length(sigGenes$Transcript.stable.ID)) {
txpos <- match(sigGenes$Transcript.stable.ID[i], harry$transcript_id)
tID <- harry$transcript_id[txpos]
if(startsWith(tID, "MSTRG")){sigGenes$Strand[i] = harry$strand[txpos]} else {sigGenes$Strand[i] = sigGenes$Strand[i]}
}
txpos <- match(sigGenes$Transcript.stable.ID[i], harry$transcript_id)
txpos
sigGenes$Transcript.stable.ID[i]
harry$transcript_id
txpos <- match(sigGenes$Transcript.stable.ID[400], harry$transcript_id)
txpos
tID <- harry$transcript_id[txpos]
tID
if(startsWith(tID, "MSTRG")){sigGenes$Strand[400] = harry$strand[txpos]} else {sigGenes$Strand[400] = sigGenes$Strand[400]}
sigGenes$Strand[400]
harry$strand[txpos]
tID
startsWith(tID, "MSTRG")
txpos <- match(sigGenes$Transcript.stable.ID[400], harry$transcript_id)
tID <- harry$transcript_id[txpos]
if(startsWith(tID, "MSTRG")){sigGenes$Strand[400] = harry$strand[txpos]} else {sigGenes$Strand[400] = sigGenes$Strand[400]}
sigGenes$Strand[400]
txpos <- match(sigGenes$Transcript.stable.ID[400], harry$transcript_id)
tID <- harry$transcript_id[txpos]
if(startsWith(tID, "MSTRG")){sigGenes$Strand[400] = as.character(harry$strand[txpos])} else {sigGenes$Strand[400] = sigGenes$Strand[400]}
sigGenes$Strand[400]
## Read in "stringtie_merged_results.gtf" and format into dataframe
directory <- "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/stringtie/"
file_merged <- "stringtie_results.gtf"
sample_merged <- "merged"
options(stringsAsFactors = FALSE)
library(rtracklayer)
library(GenomicRanges)
ST_gtfClean <- import(paste(directory, file_merged, sep = "")) #This imports the .gtf file and formats the information in the file and the 9th column to something more    readible
ST_df <- as.data.frame(ST_gtfClean) #Converts the object above to a dataframe
harry <- ST_df
txpos <- match(sigGenes$Transcript.stable.ID[400], harry$transcript_id)
tID <- harry$transcript_id[txpos]
if(startsWith(tID, "MSTRG")){sigGenes$Strand[400] = as.character(harry$strand[txpos])} else {sigGenes$Strand[400] = sigGenes$Strand[400]}
sigGenes$Strand[400]
for(i in 1:length(sigGenes$Transcript.stable.ID)) {
txpos <- match(sigGenes$Transcript.stable.ID[i], harry$transcript_id)
tID <- harry$transcript_id[txpos]
if(startsWith(tID, "MSTRG")){sigGenes$Strand[i] = as.character(harry$strand[txpos])} else {sigGenes$Strand[i] = sigGenes$Strand[i]}
}
View(harry)
rm(list=ls())
options(stringsAsFactors = FALSE)
#load results
load(file = "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/quantitation/reconst/dge.RData")
#gene level results
geneLevel = dge.genes
geneLevel$geneLevel_pctDiff = paste(sprintf("%.1f",round(100*(2^geneLevel$log2FoldChange),1)),"%",sep="") #format percent differential expression
geneLevel$geneLevel_pvalue = format(geneLevel$pvalue,digits=2,scientific=TRUE) #format p-value
geneLevel$geneLevel_FDR = sprintf("%.4f",round(geneLevel$padj,4)) #format false discovery rate (10%)
geneLevel$geneLevel_FDR[geneLevel$geneLevel_FDR=="0.0000"] = "<0.0001" #format low p-values into somethig that makes sense
geneLevel = geneLevel[,c("Gene.stable.ID","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
#isolate significant isoforms - FDR<0.05
sigGenes <- dge_v2[dge_v2$padj<0.05,]
#create print ready variables
sigGenes$Description <- unlist(lapply(strsplit(sigGenes$Gene.description,split="[",fixed=TRUE),function(a) a[1])) #format gene description
sigGenes$GeneLoc.Mb <- sprintf("%.1f",round(sigGenes$Gene.start..bp./1000000,1)) #format location by converting to mega bases
sigGenes$GeneLoc <- paste("Chr",sigGenes$Chromosome.scaffold.name,": ",sigGenes$GeneLoc.Mb," Mb",sep="") #add chr label to location
sigGenes$strand <- c("+","-")[as.numeric(sigGenes$Strand<0) + 1] #format strand direction
#orange - green
sigGenes$pctOfControl = paste(sprintf("%.1f",round(100*(2^sigGenes$log2FoldChange),1)),"%",sep="")
sigGenes$pvalue = format(sigGenes$pvalue,digits=2,scientific=TRUE)
sigGenes$FDR = sprintf("%.4f",round(sigGenes$padj,4))
sigGenes$FDR[sigGenes$FDR=="0.0000"] = "<0.0001"
sigGenes$treated_isoPct = paste(sprintf("%.1f",round(sigGenes$treated_isoPct,1)),"%")
sigGenes$Untreated_isoPct = paste(sprintf("%.1f",round(sigGenes$Untreated_isoPct,1)),"%")
sigGenes = merge(sigGenes,geneLevel,by="Gene.stable.ID",all.x=T)
sigGenes = sigGenes[,c("Gene.name","Gene.description","Gene.stable.ID","Transcript.stable.ID","Transcript.count","GeneLoc","Strand","Gene.type","pctOfControl","pvalue","FDR","treated_isoPct","Untreated_isoPct","geneLevel_pctDiff","geneLevel_pvalue","geneLevel_FDR")]
sigGenes = sigGenes[order(sigGenes$pvalue),]
sigGenes$Gene.description <- gsub(",", ";", sigGenes$Gene.description, fixed = T)
## Read in "stringtie_merged_results.gtf" and format into dataframe
directory <- "/Users/smiharry/Desktop/Saba_Lab/RNA-Seq/BE_Molly/stringtie/"
file_merged <- "stringtie_results.gtf"
sample_merged <- "merged"
options(stringsAsFactors = FALSE)
library(rtracklayer)
library(GenomicRanges)
ST_gtfClean <- import(paste(directory, file_merged, sep = "")) #This imports the .gtf file and formats the information in the file and the 9th column to something more    readible
ST_df <- as.data.frame(ST_gtfClean) #Converts the object above to a dataframe
harry <- ST_df
for(i in 1:length(sigGenes$Transcript.stable.ID)) {
txpos <- match(sigGenes$Transcript.stable.ID[i], harry$transcript_id)
tID <- harry$transcript_id[txpos]
if(startsWith(tID, "MSTRG")){sigGenes$Strand[i] = as.character(harry$strand[txpos])} else {sigGenes$Strand[i] = sigGenes$Strand[i]}
}
View(sigGenes)
library(stcr)
rsem.read.iso
?diag
load(file = paste(dirlocal, tissue, "/quantitation/",  "cnts.Merged.isoforms", ".Rdata", sep = ""))
## Create global directory objects
dir <- "/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/"
dirs2 <- "/Volumes/rn6/quantitation/liverTotalRNA/RI/"
dirlocal <- "~/Desktop/Saba_Lab/"
N <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
tissue <- "Liver"
load(file = paste(dirlocal, tissue, "/quantitation/",  "cnts.Merged.isoforms", ".Rdata", sep = ""))
View(cntsMerged)
options(stringsAsFactors = FALSE)
library(rtracklayer)
library(GenomicRanges)
ST_gtfClean <- import(paste(directory, file_merged, sep = "")) #This imports the .gtf file and formats the information in the file and the 9th column to something more    readible
ST_df <- as.data.frame(ST_gtfClean) #Converts the object above to a dataframe
## Read in "stringtie_merged_results.gtf" and format into dataframe
directory <- paste(dirlocal, tissue, "/quantitation/", sep = "")
file_merged <- "gffcmp.annotated.cleaned.gtf"
sample_merged <- "merged"
options(stringsAsFactors = FALSE)
library(rtracklayer)
library(GenomicRanges)
ST_gtfClean <- import(paste(directory, file_merged, sep = "")) #This imports the .gtf file and formats the information in the file and the 9th column to something more    readible
ST_df <- as.data.frame(ST_gtfClean) #Converts the object above to a dataframe
View(ST_df)
!duplicated(ST_df$seqnames)
unique(ST_df$seqnames)
harry <- ST_df[which(ST_df$seqnames %in% "ERCC-00003"), ]
harry
library(stcr)
rsem.read.iso
remove.packages("stcr")
library("devtools")
library(roxygen2)
setwd("/Users/smiharry/Desktop/Saba_Lab/RLBTCP")
create("stcr")
setwd("./stcr")
document()
setwd("..")
install("stcr")
library(stcr)
?rsem.read.iso
?rsem.read.gene
?rm.tech.rep
?pres.abs.table
?sep.panel
?sep.panel.sample
?content.for.plot
?track.position.table
?track.position.bytransc
?summarize.content
?contentQC
rsem.read.iso
## Create global directory objects
dir <- "/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/"
dirs2 <- "/Volumes/rn6/quantitation/liverTotalRNA/RI/"
dirlocal <- "~/Desktop/Saba_Lab/"
N <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
tissue <- "Liver"
qtype <- "counts"
level <- "transcript"
filename <- "test.level"
rsem.read.iso(dir, dirs2, tissue, N, qtype = qtype, filename = filename)
rsem.read.iso(dir, dirs2, tissue, N, qtype = qtype, level = level, filename = filename)
rsem.read.iso(dir, dirs2, tissue, N, qtype = qtype, level = level, filename = filename)
tpmMerged <- cntsMerged
load("/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/Transcript_Reconstruction/Liver/quantitation/test.level.RData")
tpmMerged <- cntsMerged
rm(cntsMerged)
load(file = paste(dirlocal, tissue, "/quantitation/",  "cnts.Merged.isoforms", ".Rdata", sep = ""))
identical(tpmMerged$transcript_id, cntsMerged$transcript_id)
identical(colnames(tpmMerged), colnames(cntsMerged))
identical(tpmMerged, cntsMerged)
qtype <- "TPM"
## Create global directory objects
dir <- "/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/"
dirs2 <- "/Volumes/rn6/quantitation/liverTotalRNA/RI/"
dirlocal <- "~/Desktop/Saba_Lab/"
N <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
tissue <- "Liver"
qtype <- "TPM"
level <- "transcript"
filename <- "test.level"
## Read in data
rsem.read.iso(dir, dirs2, tissue, N, qtype = qtype, level = level, filename = filename)
load("/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/Transcript_Reconstruction/Liver/quantitation/test.level.RData")
tpmMerged <- cntsMerged
rm(cntsMerged)
load("/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/Transcript_Reconstruction/Liver/quantitation/tpm.Merged.RData")
identical(tpmMerged$transcript_id, cntsMerged$transcript_id)
identical(colnames(tpmMerged), colnames(cntsMerged))
identical(tpmMerged, cntsMerged)
## Read in data - gene level
level <- "gene"
filename <- "tpm.Merged.genes"
rsem.read.iso(dir, dirs2, tissue, N, qtype = qtype, level = level, filename = filename)
load("/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/Transcript_Reconstruction/Liver/quantitation/tpm.Merged.genes.RData")
View(cntsMerged.gene)
## Create global directory objects
dir <- "/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/"
dirs2 <- "/Volumes/rn6/quantitation/liverTotalRNA/RI/"
dirlocal <- "~/Desktop/Saba_Lab/"
N <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
tissue <- "Liver"
qtype <- "counts"
level <- "transcript"
filename <- "cnts.Merged"
level <- "gene"
filename <- "cnts.Merged.genes"
## Read in data - gene level
level <- "gene"
filename <- "cnts.Merged.genes"
rsem.read.iso(dir, dirs2, tissue, N, qtype = qtype, level = level, filename = filename)
load("/Volumes/smiharry/Saba_Lab/RNA-Seq/HRDP/Transcript_Reconstruction/Liver/quantitation/cnts.Merged.genes.RData")
View(cntsMerged.gene)
View(cntsMerged.gene)
rsem.read.iso
i = "BXH12_1"
x = read.table(file = paste(dirs2, "batch",
h, "/RI.reconst.v1/", i, ".genes.results",
sep = ""), sep = "\t", header = TRUE)
i = "BXH12_1"
h = 1
x = read.table(file = paste(dirs2, "batch",
h, "/RI.reconst.v1/", i, ".genes.results",
sep = ""), sep = "\t", header = TRUE)
View(x)
